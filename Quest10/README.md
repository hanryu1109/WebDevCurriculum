# Quest 10. 인증의 이해

## Introduction

- 이번 퀘스트에서는 웹에서의 인증에 관해 알아보겠습니다.

## Topics

- Cookie
- Session
- JWT

## Resources

- [MDN - HTTP 쿠키](https://developer.mozilla.org/ko/docs/Web/HTTP/Cookies)
- [Cookies and Sessions](https://web.stanford.edu/~ouster/cgi-bin/cs142-fall10/lecture.php?topic=cookie)
- [JWT](https://jwt.io/)

## Checklist

- 쿠키란 무엇일까요?
  > - 클라이언트(브라우저)에 `key`와 `value`값이 들어 있는(이름, 값) 작은 데이터 파일입니다. 브라우저에 개발자 도구를 이용하여 쿠키를 직접확인 할 수 있습니다.
  > - (사진)
  - 쿠키는 어떤 식으로 동작하나요?
  - 쿠키는 어떤 식으로 서버와 클라이언트 사이에 정보를 주고받나요?
    > - 만약 클라이언트에 쿠키가 존재한다면 서버에 요청할 때 쿠키를 헤더에 포함시키도록 되어있습니다.
    > - 그러나, 클라이언트에 쿠키가 존재하지 않는다면 서버에서 쿠키를 만듭니다. 그리고 서버가 HTTP 응답 헤더(header)의 `Set-Cookie`에 내용을 넣어 잔달하면, 브라우저는 이 내용을 자체적으로 브라우저에 저장합니다.
    > - 다음에 도메인에서 서버로 어떤 요청을 할 때 요청 header에 쿠키를 넣어서 자동으로 서버에 전송합니다. (쿠키는 사용자가 따로 요청하지않아도 브라우저가 요청시에 헤더에 젛어서 자동으로 서버에 전송합니다.)
- 웹 어플리케이션의 세션이란 무엇일까요?
  > - 사용자가 우리 어플리케이션에 로그인하게 되면, 우리는 로그인한 사용자에 대한 정보를 받게 됩니다. 그리고 우리는 쿠키로 들어온 세션 ID를 이용하여 데이터베이스나 서버 메모리 상에 특정 사용자에 관한 내용을 관리할 수 있습니다. 접속한 사용자에 대한 정보를 기반으로 생성되는 추상적인 과정과 개념을 세션이라고 합니다.
  > - 일정 시간 동안 같은 사용자로부터 들어오는 일련의 요구를 하나의 상태로 보고 그 상태를 유지시키는 기술을 이야기합니다.
  > - 사용자가 브라우저를 닫고 서버와의 연결을 끝내는 시점까지를 세션이라고 합니다.
  > - 세션은 쿠키를 기반으로 하고 있지만, 사용자 정보 파일을 클라이언트(브라우저)에 저장하는 쿠키와 달리 세션은 서버측에서 관리합니다.
  - 세션의 ID와 내용은 각각 어디에 저장되고 어떻게 서버와 교환되나요?
    > - 세션 ID는 클라이언트의 쿠키에 저장이 되고, 세션 ID와 내용은 서버(서버 메모리)에 저장됩니다.
    > - 예를 들어, 유저가 로그인에 성공하게 되면, 서버는 유저 정보를 바탕으로 DB에 유저를 생성하게 됩니다. 이 유저 정보가 저장된 세션 ID를 클라이언트의 쿠키로 저장하게 됩니다. 매 요청 시 쿠키에 있는 세션 ID를 통해 서버에서는 세션 DB를 조회해서 유저의 정보를 가져옵니다.
- JWT란 무엇인가요?
  > - JWT란 `JSON Web Token`의 줄임말로서 JSON 자료를 Encoding한 형태의 토큰을 의미합니다. Header, Payload. Signature 세 가지 파트로 이루어져 있으며 각 부분은 `.`을 이용하여 구분됩니다.
  >   (사진)
  - JWT 토큰은 어디에 저장되고 어떻게 서버와 교환되나요?
    > - JWT 토큰은 클라이언트에 저장됩니다(브라우저에서는 일반적으로 Local Storage를 가장 흔하게 사용합니다면, 보안적인 이슈가 있기도 합니다). 클라이언트는 매 요청마다 헤더에 JWT를 실어 보내 인증을 확인하고 서버에서는 JWT를 확인하는 과정만 거친 후 정보를 보내주면 됩니다.
- 세션에 비해 JWT가 가지는 장점은 무엇인가요? 또 JWT에 비해 세션이 가지는 장점은 무엇인가요?
  > - 세션과 같은 방식처럼 서버에서 별도로 세션 ID를 저장해두거나, 세션 DB를 가질 필요도 없습니다. 유저 인증을 하는데 있어 서버의 부담이 훨씬 줄어들게 됩니다.
- JWT도 탈취되었을 경우의 안정성 때문에 유효기간을 짧게 가져갑니다. 만약 토큰이 탈취되어서 서버가 이를 강제로 끊지는 못하겠지만 짧은 시간만 유효하기 때문에 최소한의 보안성을 보장할 수 있습니다.
- 동시 로그인을 막아야 하는 경우라면 JWT가 부적합할 수 있습니다. 
- 모바일 시대가 되면서 JWT가 더 성장하기도 했습니다. 왜냐하면 한 번 로그인하고 그 이후에는 계속 로그인된 상태여야만 했기에 JWT가 적합했습니다. 발급된 토큰이 만료되면 Refresh Token으로 다시 Access Token을 주기적으로 갱신합니다. Refresh Token은 보안상 중요한 정보이므로, 안전한 방식으로 저장되어야 합니다. 예를 들어, 안드로이드나 iOS 앱에서는 안전한 저장소인 Keychain 또는 Keystore에 저장합니다

## Quest

- 이번에는 메모장 시스템에 로그인 기능을 넣고자 합니다.
  - 사용자는 딱 세 명만 존재한다고 가정하고, 아이디와 비밀번호, 사용자의 닉네임은 하드코딩해도 무방합니다.
  - 로그인했을 때 해당 사용자가 이전에 작업했던 탭들과 마지막으로 활성화된 탭 등의 상태가 로딩 되어야 합니다.
  - 세션을 이용한 버전과, JWT를 이용한 버전 두 가지를 만들어 보세요!
    - 세션을 이용할 경우 세션은 서버의 메모리나 파일에 저장하면 됩니다.

## Advanced

- Web Authentication API(WebAuthn)은 무엇인가요?
  > - 아이디 / 비밀번호 인증절차가 아닌 Public Key 기반의 웹인증을 이야기합니다.
  > - 기존에 인증 방식은 비밀번호를 보내서 해당 비밀번호를 암호한 결과가 서버에 저장된 암호화된 비밀번호와 일치하는지를 확인하는 방식이었습니다.
  > - Web Authentication API(WebAuthn)는 서버에서 공개키와 challenge
  > - FIDO2라는 인증기술이 있으며, 내장인증(지문인식, 얼굴인식, 모바일 핀번호), 외부인증(전용인증어플, 하드웨어 보안키)이 있습니다.

## Think About

쿠키와 세션은 왜 필요할까요? HTTP 프로토콜에는 2가지 특징이 존재합니다.

1. 클라이언트가 요청을 한 후 응답을 받으면 그 연결을 끊는다 (connectionless)
2. 클라이언트와 서버의 통신이 끝나면 상태를 유지하지 않는다 (stateless)

위 2가지 특성으로 인해 서버는 클라이언트와 연결이 끊어지게 되면 클라이언트의 이전 상태를 기억하지 못하게 되고, 클라이언트가 과거에 로그인을 성공하더라도 로그인 정보를 유지할 수가 없게 됩니다.

하지만 현실세계에서는 브라우저에 접속하고 있는 현재 유저를 인지하고 있어야 하는 경우가 더 많습니다. 쇼핑몰에서 로그인 한 후 옷을 장바구니에 보관했는데 매번 페이지를 이동할 때 마다 새롭게 인증을 해야한다면 사용률이 현저히 떨어지겠죠 ? 이런 특성을 보완하려면 **웹 통신간 정보가 유지** 되어야 하고, **정보를 유지하기 위해서 사용하는 저장소가 바로 쿠키와 세션**입니다.
